<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lava Notes</title>
    <link rel="icon" type="image/gif"
        href="https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f5/Lava_JE14.gif">
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/devicon@2.17.0/devicon.min.css">
    <style>
        :root {
            --bg-primary: #0d0d0d;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #252525;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --accent: #e8a860;
            --accent-hover: #f0b870;
            --accent-muted: #d4915a;
            --border: #333;
            --danger: #e85050;
            --success: #50c878;
            --panel-width: 280px;
            --header-height: 56px;
            --transition: 0.25s ease;
        }

        body.light-theme {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8e8e8;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --border: #ddd;
        }

        [v-cloak] {
            display: none !important;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .splash-logo {
            width: 100px;
            height: 100px;
            border-radius: 16px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100%;
            position: relative;
        }

        .ssr {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            z-index: -4;
            transform: rotateX(90.01deg);
            pointer-events: none;
        }
    </style>
</head>

<body>
    <!-- Splash Screen -->
    <div id="splash" class="splash-screen">
        <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f5/Lava_JE14.gif" alt="Loading"
            class="splash-logo">
    </div>
    <main class="main ssr">__SSR_CONTENT__</main>

    <div id="app" v-cloak>
        <div class="app-container">
            <!-- Panel Toggle (outside panel) -->
            <button class="panel-toggle" :class="{ collapsed: isPanelCollapsed }" @click="togglePanel">
                <i :class="'icon light-icon-' + (isPanelCollapsed ? 'chevron-right' : 'chevron-left')"></i>
            </button>

            <!-- Left Panel -->
            <aside class="left-panel" :class="{ collapsed: isPanelCollapsed }">
                <div class="panel-header">
                    <div @click="goBack()" class="logo-container">
                        <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f5/Lava_JE14.gif"
                            alt="Lava Notes" class="logo" :style="{ filter: logoFilter }">
                        <span class="logo-text">{{ t('appName') }}</span>
                    </div>
                    <div class="panel-actions">
                        <button class="icon-btn" @click="openCreateModal" v-if="isAuthenticated" :title="t('create')">
                            <i class="icon light-icon-plus"></i>
                        </button>
                        <button class="icon-btn" @click="openSettings" :title="t('settings')">
                            <i class="icon light-icon-settings"></i>
                        </button>
                    </div>
                </div>

                <div class="panel-content">
                    <transition name="breadcrumb-slide">
                        <div class="breadcrumb" v-if="currentCategory" :key="currentCategory.id">
                            <button class="breadcrumb-btn" @click="goBack">
                                <i class="icon light-icon-arrow-left"></i>
                                <span>{{ t('categories') }}</span>
                            </button>
                            <span class="breadcrumb-current">{{ currentCategory.name }}</span>
                        </div>
                    </transition>

                    <div class="panel-lists-container">
                        <transition name="slide-left">
                            <div v-if="!currentCategory" key="categories" class="items-list">
                                <div v-for="cat in categories" :key="cat.id" class="item" @click="selectCategory(cat)"
                                    @contextmenu.prevent="openCategoryContextMenu($event, cat)">
                                    <div class="item-icon">
                                        <i v-if="isDevicon(cat.icon)" :class="cat.icon"></i>
                                        <i v-else :class="'icon light-icon-' + (cat.icon || 'folder')"></i>
                                    </div>
                                    <span class="item-name">{{ cat.name }}</span>
                                </div>
                                <div v-if="categories.length === 0" class="empty-state">{{ t('noCategories') }}</div>
                            </div>
                        </transition>

                        <transition name="slide-right">
                            <div v-if="currentCategory" :key="'notes-' + currentCategory.id" class="items-list"
                                :class="{ loading: notesLoading }">
                                <div v-for="note in filteredNotes" :key="note.id" class="item"
                                    :class="{ active: currentNote && currentNote.id === note.id }"
                                    @click="selectNote(note)" @contextmenu.prevent="openContextMenu($event, note)"
                                    :title="formatDate(note.updated_at)">
                                    <div class="item-icon">
                                        <i v-if="isDevicon(note.icon)" :class="note.icon"></i>
                                        <i v-else :class="'icon light-icon-' + (note.icon || 'file-text')"></i>
                                    </div>
                                    <span class="item-name">{{ displayNoteName(note.name) }}</span>
                                    <span v-if="isAuthenticated && getNoteLangCode(note.name)"
                                        class="item-lang-badge">{{
                                        getNoteLangCode(note.name) }}</span>
                                </div>
                                <div v-if="filteredNotes.length === 0" class="empty-state">{{ t('noNotes') }}</div>
                            </div>
                        </transition>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content" v-if="forceUpdate>-1">
                <div v-if="!currentNote" class="welcome-screen">
                    <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f5/Lava_JE14.gif"
                        alt="Lava Notes" class="welcome-logo" :style="{ filter: logoFilter }">
                    <h1>{{ t('welcome') }}</h1>
                    <p>{{ t('selectNote') }}</p>
                </div>

                <div v-else class="note-view">
                    <div class="note-header">
                        <div class="note-title-section">
                            <div :class="isEditing ? 'note-title-edit-row' : 'note-title-row'">
                                <template v-if="isEditing">
                                    <input type="text" class="note-title-input" v-model="editTitle"
                                        :placeholder="t('enterName')" />
                                </template>
                                <template v-else>
                                    <h1 class="note-title">{{ displayNoteName(currentNote.name) }}</h1>
                                </template>
                                <span v-if="getNoteLangCode(currentNote.name)" class="lang-code-badge">
                                    {{getNoteLangCode(currentNote.name)}}</span>
                                <span v-if="currentNote.icon === 'lock'" class="private-badge" :title="t('private')">
                                    <i class="icon light-icon-lock"></i>
                                </span>
                                <span v-if="noteEncrypted || currentNote._decrypted" class="private-badge"
                                    style="color:var(--success)" :title="t('encrypted')">
                                    <i class="icon"
                                        :class="{'light-icon-shield-check': !currentNote._decrypted, 'light-icon-key': currentNote._decrypted}"></i>
                                </span>
                            </div>
                        </div>
                        <div class="note-actions" v-if="isAuthenticated">
                            <button v-if="isEditing" class="icon-btn" @click="toggleChatPanel" :title="t('askLLM')">
                                <i class="icon light-icon-message-circle"></i>
                            </button>
                            <button v-if="isEditing" class="icon-btn" @click="togglePreview"
                                :title="showPreview ? t('hidePreview') : t('showPreview')">
                                <i :class="'icon light-icon-' + (showPreview ? 'code' : 'eye')"></i>
                            </button>
                            <button class="icon-btn" @click="toggleEditMode" :title="t(isEditing ? 'cancel': 'edit')">
                                <i :class="'icon light-icon-' + (isEditing ? 'x' : 'pencil')"></i>
                            </button>
                            <button class="icon-btn danger" @click="confirmDelete" :title="t('delete')">
                                <i class="icon light-icon-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Auto-save recovery banner -->
                    <div v-if="draftRecovery.show" class="draft-recovery-banner">
                        <span>{{ t('draftFound') }} ({{ draftRecovery.charDiff > 0 ? '+' : '' }}{{
                            draftRecovery.charDiff }} chars)</span>
                        <div class="draft-recovery-actions">
                            <button class="btn-small" @click="loadDraft">{{ t('loadDraft') }}</button>
                            <button class="btn-small btn-secondary" @click="discardDraft">{{ t('discardDraft')
                                }}</button>
                        </div>
                    </div>

                    <!-- Formatting Toolbar (visible only in edit mode) -->
                    <div v-if="isEditing && !showPreview" class="formatting-toolbar">
                        <button class="icon-btn" @click="insertFormat('bold')" title="Bold (Ctrl+B)">
                            <i class="icon light-icon-bold"></i>
                        </button>
                        <button class="icon-btn" @click="insertFormat('italic')" title="Italic (Ctrl+I)">
                            <i class="icon light-icon-italic"></i>
                        </button>
                        <button class="icon-btn" @click="insertFormat('underline')" title="Underline">
                            <i class="icon light-icon-underline"></i>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button class="icon-btn" @click="insertFormat('subscript')" title="Subscript">
                            <i class="icon light-icon-subscript"></i>
                        </button>
                        <button class="icon-btn" @click="insertFormat('superscript')" title="Superscript">
                            <i class="icon light-icon-superscript"></i>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button class="icon-btn" @click="showLinkModal = true" title="Insert Link">
                            <i class="icon light-icon-link"></i>
                        </button>
                        <button class="icon-btn" @click="insertFormat('image')" title="Insert Image">
                            <i class="icon light-icon-photo"></i>
                        </button>
                        <div class="toolbar-separator"></div>
                        <button class="icon-btn" @click="showFindReplace = true" title="Find & Replace">
                            <i class="icon light-icon-search"></i>
                        </button>
                    </div>

                    <div class="note-content">
                        <div v-if="isEditing && !showPreview" class="editor-chat-wrapper">
                            <div class="editor-container" style="flex:1;min-width:0">
                                <vue-monaco-editor v-model:value="editContent" :theme="computedTheme"
                                    :options="editorOptions" language="markdown" height="72vh"
                                    @before-mount="handleBeforeMount" @mount="handleEditorMount"></vue-monaco-editor>
                            </div>
                            <div class="chat-panel" :class="{ open: showChatPanel }">
                                <div class="chat-panel-header">
                                    <img src="https://wiki.hypixel.net/images/a/ae/SkyBlock_entities_fried_chicken.gif"
                                        alt="Chicken" style="width:28px;height:28px">
                                    <h3>{{ t('chicken') }}</h3>
                                    <button class="icon-btn" @click="clearChat" title="Clear chat"
                                        v-show="chatMessages.length > 0"><i class="icon light-icon-trash"></i></button>
                                    <button class="icon-btn" @click="showChatPanel = false"><i
                                            class="icon light-icon-x"></i></button>
                                </div>
                                <div class="chat-panel-body">
                                    <div class="chat-messages">
                                        <div v-for="(msg, i) in chatMessages" :key="i" class="chat-msg"
                                            :class="msg.role" v-html="formatChatMsg(msg.content)"></div>
                                        <div v-if="llmLoading" class="chat-msg assistant">{{ t('thinking') }}</div>
                                    </div>
                                </div>
                                <div class="chat-input-area">
                                    <div class="chat-toggles">
                                        <label><input type="checkbox" v-model="chatIncludeDoc"> {{ t('includeDocument')
                                            }}</label>
                                        <label><input type="checkbox" v-model="chatUseTools"
                                                :disabled="!chatIncludeDoc"> {{ t('useTools') }}</label>
                                    </div>
                                    <textarea v-model="llmPrompt" :placeholder="t('enterPrompt')"
                                        @keydown.enter.ctrl="sendChat"></textarea>
                                    <div class="chat-send-row">
                                        <button class="btn btn-primary" @click="sendChat"
                                            :disabled="!llmPrompt.trim() || llmLoading">{{ t('send') }}</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-else-if="isEditing && showPreview" class="markdown-content preview-content"
                            v-html="previewMarkdown"></div>
                        <div v-else class="markdown-content">
                            <div v-html="renderedMarkdown"></div>
                            <div class="note-meta" v-if="currentNote?.created_at && currentNote?.content">
                                <span>{{ t('created') }}: {{ formatDate(currentNote.created_at) }}</span>
                                <span>{{ t('updated') }}: {{ formatDate(currentNote.updated_at) }}</span>
                            </div>
                        </div>
                    </div>

                    <div v-if="isEditing" class="editor-footer">
                        <button class="btn btn-primary" @click="saveNote">
                            <i class="icon light-icon-device-floppy"></i>
                            {{ t('save') }}
                        </button>
                        <button class="btn" @click="cancelEdit">{{ t('cancel') }}</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Context Menu -->
        <div v-if="contextMenu.visible && isAuthenticated" class="context-menu"
            :style="{ left: contextMenu.x + 'px', top: contextMenu.y + 'px' }" @click.stop>
            <template v-if="contextMenu.type === 'note'">
                <div class="context-menu-item" @click="cloneNote">
                    <i class="icon light-icon-copy"></i>
                    {{ t('clone') }}
                </div>
                <div class="context-menu-item" @click="translateNote">
                    <i class="icon light-icon-language"></i>
                    {{ t('translate') }}
                </div>
                <div v-if="contextMenu.note.icon == 'lock' && contextMenu.note.id == currentNote.id"
                    class="context-menu-item" @click="publishNote()">
                    <i class="icon light-icon-share"></i>
                    {{ t('publish') }}
                </div>
                <div class="context-menu-item danger" @click="deleteContextNote">
                    <i class="icon light-icon-trash"></i>
                    {{ t('delete') }}
                </div>
            </template>
            <template v-else-if="contextMenu.type === 'category'">
                <div class="context-menu-item danger" @click="deleteContextCategory">
                    <i class="icon light-icon-trash"></i>
                    {{ t('delete') }}
                </div>
            </template>
        </div>

        <!-- Settings Modal -->
        <div class="modal-overlay" v-if="showSettings" @click.self="closeSettings">
            <div class="modal">
                <div class="modal-header">
                    <h2>{{ t('settings') }}</h2>
                    <button class="icon-btn" @click="closeSettings">
                        <i class="icon light-icon-x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>{{ t('theme') }}</label>
                        <select v-model="settings.theme" @change="applyHue">
                            <option value="dark">{{ t('dark') }}</option>
                            <option value="light">{{ t('light') }}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>{{ t('language') }}</label>
                        <select v-model="settings.language" @change="saveSettings">
                            <option value="en">English</option>
                            <option value="ru">Русский</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>{{ t('hueShift') }}: {{ settings.hue_shift }}°</label>
                        <input type="range" min="0" max="360" v-model.number="settings.hue_shift" @input="applyHue">
                    </div>

                    <hr>
                    <h3>{{ t('llmSettings') }}</h3>
                    <div class="form-group">
                        <label>{{ t('provider') }}</label>
                        <select v-model="llmSettings.provider">
                            <option value="">{{ t('none') }}</option>
                            <option value="gemini">Gemini</option>
                            <option value="openai">OpenAI</option>
                            <option value="claude">Claude</option>
                        </select>
                    </div>
                    <div class="form-group" v-if="llmSettings.provider">
                        <label>API Key</label>
                        <input type="password" v-model="llmSettings.apiKey" placeholder="API Key">
                    </div>
                    <div class="form-group" v-if="llmSettings.provider === 'openai'">
                        <label>{{ t('endpoint') }}</label>
                        <input type="text" v-model="llmSettings.endpoint" placeholder="https://api.openai.com/v1">
                    </div>
                    <div class="form-group" v-if="llmSettings.provider">
                        <label>{{ t('model') }}</label>
                        <input type="text" v-model="llmSettings.model" :placeholder="getDefaultModel()">
                    </div>

                    <hr>
                    <h3>{{ t('encryptionKey') }}</h3>
                    <div class="form-group" style="position: relative;">
                        <label class="settings-checkbox-label" v-if="settings.encryptionKey"><input type="checkbox"
                                v-model="settings.saveEncryptionKey"> {{ t('saveKey') }}</label>
                        <input type="password" v-model="settings.encryptionKey"
                            :placeholder="t('encryptionKeyPlaceholder')">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" @click="saveAllSettings">{{ t('save') }}</button>
                </div>
            </div>
        </div>

        <!-- Create Modal -->
        <div class="modal-overlay" v-if="showCreateModal || showSetIconPopup" @click.self="closeCreateModal">
            <div class="modal">
                <div class="modal-header" v-if="!showSetIconPopup">
                    <h2>{{ currentCategory ? t('createNote') : t('createCategory') }}</h2>
                    <button class="icon-btn" @click="closeCreateModal">
                        <i class="icon light-icon-x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group" v-if="!showSetIconPopup">
                        <label>{{ t('name') }}</label>
                        <input type="text" v-model="createForm.name" :placeholder="t('enterName')"
                            @keyup.enter="create">
                    </div>
                    <div class="form-group">
                        <label>{{ t('icon') }}</label>
                        <div class="icon-picker">
                            <button v-for="icon in defaultLightIcons" :key="icon" class="icon-option"
                                :class="{ selected: createForm.icon === icon }" @click="createForm.icon = icon; createForm.customIcon = ''">
                                <i :class="'icon light-icon-' + icon"></i>
                            </button>
                            <button v-for="icon in defaultDevIcons" :key="icon" class="icon-option"
                                :class="{ selected: createForm.customIcon ===  'devicon-' + icon }"
                                @click="createForm.customIcon = 'devicon-' + icon; createForm.icon =''">
                                <i :class="'icon devicon-' + icon"></i>
                            </button>
                            <button v-show="defaultLightIcons.length < 20" class="icon-option" style="font-size: 10px"
                                @click="loadMoreIcons()">load more</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" @click="closeCreateModal">{{ t('cancel') }}</button>
                    <button class="btn btn-primary" @click="showSetIconPopup ? saveIcon() : create() ">{{
                        t(showSetIconPopup ? 'save': 'create')
                        }}</button>
                </div>
            </div>
        </div>
        <!-- Translate Modal -->
        <div class="modal-overlay" v-if="showTranslateModal" @click.self="showTranslateModal = false">
            <div class="modal modal-small">
                <div class="modal-header">
                    <h2>{{ t('translate') }}</h2>
                    <button class="icon-btn" @click="showTranslateModal = false">
                        <i class="icon light-icon-x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <label style="margin-bottom:8px;display:block">{{ t('targetLanguage') }}</label>
                    <div class="translate-modal-langs">
                        <label><input type="radio" v-model="translateLangMode" value="en"> English</label>
                        <label><input type="radio" v-model="translateLangMode" value="ru"> Русский</label>
                        <label><input type="radio" v-model="translateLangMode" value="custom"> Other:</label>
                    </div>
                    <input v-if="translateLangMode === 'custom'" type="text" v-model="translateCustomLang"
                        class="translate-lang-input" placeholder="e.g. Spanish, German, Japanese...">
                </div>
                <div class="modal-footer">
                    <button class="btn" @click="showTranslateModal = false">{{ t('cancel') }}</button>
                    <button class="btn btn-primary" @click="doTranslate" :disabled="llmLoading">{{ t('translate')
                        }}</button>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation -->
        <div class="modal-overlay" v-if="showDeleteConfirm" @click.self="showDeleteConfirm = false">
            <div class="modal modal-small">
                <div class="modal-header">
                    <h2>{{ t('confirmDelete') }}</h2>
                    <button class="icon-btn" @click="showDeleteConfirm = false">
                        <i class="icon light-icon-x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f5/Lava_JE14.gif"
                        alt="Lava" class="delete-modal-logo" :style="{ filter: logoFilter }">
                    <p class="delete-modal-text">{{ t('deleteWarningLava') }}<br><strong v-if="noteToDelete">{{
                            displayNoteName(noteToDelete.name) }}</strong></p>
                </div>
                <div class="modal-footer">
                    <button class="btn" @click="showDeleteConfirm = false">{{ t('cancel') }}</button>
                    <button class="btn btn-danger" @click="deleteNote">{{ t('throwIntoLava') }}</button>
                </div>
            </div>
        </div>

        <!-- Category Delete Confirmation -->
        <div class="modal-overlay" v-if="showCategoryDeleteConfirm" @click.self="showCategoryDeleteConfirm = false">
            <div class="modal modal-small">
                <div class="modal-header">
                    <h2>{{ t('confirmDelete') }}</h2>
                    <button class="icon-btn" @click="showCategoryDeleteConfirm = false">
                        <i class="icon light-icon-x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f5/Lava_JE14.gif"
                        alt="Lava" class="delete-modal-logo" :style="{ filter: logoFilter }">
                    <p class="delete-modal-text">{{ t('deleteCategoryWarning') }}<br><strong v-if="categoryToDelete">{{
                            categoryToDelete.name }}</strong></p>
                </div>
                <div class="modal-footer">
                    <button class="btn" @click="showCategoryDeleteConfirm = false">{{ t('cancel') }}</button>
                    <button class="btn btn-danger" @click="deleteCategory">{{ t('throwIntoLava') }}</button>
                </div>
            </div>
        </div>

        <!-- Link Insert Modal -->
        <div class="modal-overlay" v-if="showLinkModal" @click.self="showLinkModal = false">
            <div class="modal modal-small">
                <div class="modal-header">
                    <h2>{{ t('insertLink') }}</h2>
                    <button class="icon-btn" @click="showLinkModal = false">
                        <i class="icon light-icon-x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>{{ t('linkText') }}</label>
                        <input type="text" v-model="linkForm.text" :placeholder="t('linkTextPlaceholder')">
                    </div>
                    <div class="form-group">
                        <label>{{ t('linkUrl') }}</label>
                        <input type="text" v-model="linkForm.url" placeholder="https:// or [[note-name]]"
                            @input="onLinkInput">
                        <div v-if="linkSuggestions.length > 0" class="link-suggestions">
                            <div v-for="note in linkSuggestions" :key="note.id" class="link-suggestion"
                                @click="selectLinkSuggestion(note)">
                                {{ displayNoteName(note.name) }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" @click="showLinkModal = false">{{ t('cancel') }}</button>
                    <button class="btn btn-primary" @click="insertLink">{{ t('insert') }}</button>
                </div>
            </div>
        </div>

        <!-- Find & Replace Modal -->
        <div class="modal-overlay" v-if="showFindReplace" @click.self="showFindReplace = false">
            <div class="modal find-replace-modal">
                <div class="modal-header">
                    <h2>{{ t('findReplace') }}</h2>
                    <button class="icon-btn" @click="showFindReplace = false">
                        <i class="icon light-icon-x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="find-replace-row">
                        <input type="text" v-model="findReplaceForm.find" :placeholder="t('findPlaceholder')">
                    </div>
                    <div class="find-replace-row">
                        <input type="text" v-model="findReplaceForm.replace" :placeholder="t('replacePlaceholder')">
                    </div>
                    <div class="find-replace-options">
                        <label><input type="checkbox" v-model="findReplaceForm.regex"> {{ t('useRegex') }}</label>
                        <label><input type="checkbox" v-model="findReplaceForm.caseSensitive"> {{ t('caseSensitive')
                            }}</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" @click="findNext">{{ t('findNext') }}</button>
                    <button class="btn" @click="replaceOne">{{ t('replaceOne') }}</button>
                    <button class="btn btn-primary" @click="replaceAll">{{ t('replaceAll') }}</button>
                </div>
            </div>
        </div>
    </div>
    <script type="importmap">
    {
        "imports": {
            "vue": "https://unpkg.com/vue@3.6.0-alpha.6/dist/vue.esm-browser.js",
            "vue-demi": "https://unpkg.com/vue@3.6.0-alpha.6/dist/vue.esm-browser.js",
            "state-local": "https://unpkg.com/state-local@1.0.7/lib/es/state-local.js",
            "@monaco-editor/loader": "https://unpkg.com/@monaco-editor/loader@1.7.0/lib/es/index.js",
            "@guolao/vue-monaco-editor": "https://unpkg.com/@guolao/vue-monaco-editor@1.6.0/files/lib/es/index.js"
        }
    }
    </script>
    <script type="module">

        const getBasePathOuter = () => {
            const path = window.location.pathname;
            const match = path.match(/^(.*?\/)note\/|^(.*?)?$/);
            return match ? (match[1] || match[2] || '') : ''
        };

        const basePathOuter = getBasePathOuter();
        await import(getBasePathOuter() + 'static/main.js')

    </script>
</body>

</html>
